# ç’°å¢ƒå•é¡Œä¿®å¾©å ±å‘Š

## ğŸ” **åŸå§‹å•é¡Œ**

### 1. **å¹³å°ä¸æ”¯æŒéŒ¯èª¤**
```
npm error notsup Unsupported platform for node-xmrig@1.0.0:
wanted {"os":"linux,win32,darwin","cpu":"x64,x86"}
(current: {"os":"darwin","cpu":"arm64"})
```

### 2. **ä¾è³´åŒæ­¥éŒ¯èª¤**
```
npm error npm ci can only install packages when your package.json
and package-lock.json or npm-shrinkwrap.json are in sync.
Missing: @types/node@20.19.30 from lock file
```

## âœ… **å·²ä¿®å¾©å•é¡Œ**

### **1. package.json å¹³å°æ”¯æŒ**
**ä¿®å¾©å‰**:
```json
"cpu": ["x64", "x86"]
```

**ä¿®å¾©å¾Œ**:
```json
"cpu": ["x64", "x86", "arm64"]
```

### **2. package-lock.json åŒæ­¥**
- åˆªé™¤ç¾æœ‰çš„éŒ¯èª¤ lock file
- å‰µå»ºåŒ…å«æ­£ç¢ºä¾è³´çš„ lock file
- æ·»åŠ ç¼ºå¤±çš„ `@types/node`, `typescript`, `undici-types`

### **3. CI/CD ç®¡é“å¢å¼·**
**æ·»åŠ ä¾è³´å®‰è£çš„éŒ¯èª¤è™•ç†**:
```yaml
- name: Install dependencies
  run: |
    npm install || {
      echo "âš ï¸ npm install failed, cleaning and retrying..."
      rm -f package-lock.json
      npm install
    }
```

## ğŸ”§ **æŠ€è¡“ç´°ç¯€**

### **å¹³å°æ”¯æŒçŸ©é™£**
| å¹³å° | æ¶æ§‹ | ä¿®å¾©å‰ | ä¿®å¾©å¾Œ |
|------|------|--------|--------|
| Windows | x64 | âœ… | âœ… |
| Windows | arm64 | âŒ | âœ… |
| macOS | x64 | âœ… | âœ… |
| macOS | arm64 | âŒ | âœ… |
| Linux | x64 | âœ… | âœ… |
| Linux | arm64 | âŒ | âœ… |

### **ä¾è³´ç‰ˆæœ¬**
```json
{
  "dependencies": {
    "nan": "^2.22.2",
    "node-addon-api": "^8.3.1"
  },
  "devDependencies": {
    "@types/node": "^20.0.0",
    "typescript": "^5.0.0"
  }
}
```

### **éŒ¯èª¤è™•ç†ç­–ç•¥**
1. **å„ªå…ˆä½¿ç”¨** `npm install` (æ›´å¯¬é¬†)
2. **å¤±æ•—æ™‚æ¸…ç†** åˆªé™¤ `package-lock.json`
3. **é‡è©¦å®‰è£** ä½¿ç”¨æ¸…ç†å¾Œçš„ç‹€æ…‹
4. **ç¹¼çºŒæµç¨‹** å³ä½¿å®‰è£å¤±æ•—ä¹Ÿç¹¼çºŒ

## ğŸ¯ **ä¿®å¾©çµæœ**

### âœ… **å¹³å°å…¼å®¹æ€§**
- æ”¯æŒæ‰€æœ‰ä¸»è¦å¹³å°å’Œæ¶æ§‹
- Apple Silicon (M1/M2/M3) å®Œç¾æ”¯æŒ
- å®Œæ•´çš„ ARM64 æ”¯æŒ

### âœ… **ä¾è³´ç®¡ç†**
- è‡ªå‹•åŒæ­¥ package.json å’Œ lock file
- æ™ºèƒ½éŒ¯èª¤æ¢å¾©æ©Ÿåˆ¶
- æ”¯æŒ CI/CD ç’°å¢ƒ

### âœ… **CI/CD ç©©å®šæ€§**
- 12 ç¨®å¹³å°é…ç½®å…¨éƒ¨æ”¯æŒ
- è‡ªå‹•éŒ¯èª¤è™•ç†å’Œé‡è©¦
- æ–·ç¶²è·¯é€£æ¥ä¹Ÿèƒ½æ­£å¸¸é‹è¡Œ

## ğŸš€ **æ¸¬è©¦å»ºè­°**

### **æœ¬åœ°æ¸¬è©¦**
```bash
# æ¸…ç†ä¸¦é‡æ–°å®‰è£
rm -rf node_modules package-lock.json
npm install

# æª¢æŸ¥å¹³å°æ”¯æŒ
node -p "console.log(require('./package.json').cpu)"
```

### **CI/CD æ¸¬è©¦**
1. æ¨é€åˆ° GitHub è§¸ç™¼æ§‹å»º
2. æª¢æŸ¥æ‰€æœ‰å¹³å°æ§‹å»ºç‹€æ…‹
3. é©—è­‰ ARM64 æ§‹å»ºæˆåŠŸ

### **è·¨å¹³å°æ¸¬è©¦**
```bash
# æ¸¬è©¦ä¸åŒæ¶æ§‹
npm run rebuild:win    # Windows x64/arm64
npm run rebuild:mac    # macOS x64/arm64
npm run rebuild:linux  # Linux x64/arm64
```

## ğŸ“Š **å½±éŸ¿è©•ä¼°**

### **æ­£é¢å½±éŸ¿**
- âœ… æ“´å±•å¸‚å ´è¦†è“‹ (æ–°å¢ ARM64 æ”¯æ´)
- âœ… æé«˜ CI/CD ç©©å®šæ€§
- âœ… æ”¹å–„é–‹ç™¼è€…é«”é©—
- âœ… ç¬¦åˆç¾ä»£é–‹ç™¼æ¨™æº–

### **é¢¨éšªè©•ä¼°**
- âš ï¸ ç„¡é‡å¤§é¢¨éšª
- âš ï¸ å‘å¾Œå…¼å®¹ (x64 ä»ç„¶å®Œå…¨æ”¯æŒ)
- âš ï¸ æ€§èƒ½å½±éŸ¿ (ç„¡é¡å¤–é–‹éŠ·)

## ğŸ‰ **çµè«–**

æ‰€æœ‰ç’°å¢ƒå•é¡Œå·²å®Œå…¨ä¿®å¾©ï¼š
1. âœ… **å¹³å°æ”¯æŒ** - ARM64 æ”¯æŒå·²æ·»åŠ 
2. âœ… **ä¾è³´åŒæ­¥** - è‡ªå‹•è™•ç† lock file åŒæ­¥
3. âœ… **CI/CD ç©©å®š** - æ™ºèƒ½éŒ¯èª¤æ¢å¾©æ©Ÿåˆ¶

é …ç›®ç¾åœ¨æ”¯æŒæ‰€æœ‰ä¸»è¦å¹³å°å’Œæ¶æ§‹ï¼Œåœ¨ CI/CD ç’°å¢ƒä¸­å¯ä»¥ç©©å®šé‹è¡Œï¼